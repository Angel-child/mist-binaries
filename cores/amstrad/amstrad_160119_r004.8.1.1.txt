Stabilized version (it's just about optimization and robustness here)